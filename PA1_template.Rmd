# Reproducible Research - Peer Assessment 1  

This assignment makes use of data from a personal activity monitoring device (activity.csv). This device collects data at 5 minute intervals through out the day. The data consists of two months of data from an anonymous individual collected during the months of October and November, 2012 and include the number of steps taken in 5 minute intervals each day.  

A number of questions are answered as part of this report, including:
* what are the mean and median steps per day.
* what are the daily activity patterns.
* How should we impute missing information so as to have a complete dataset.
* What are the differences between weekday activity and weekend activity patterns.  


The activity data consists of 17,568 observations over the following 3 features:
* steps (numeric indicating the number of steps taken)
* date (date indicating the date of the measurement)
* interval (numeric indicating the 5 minute time period during which the measurement was taken)  



```{r echo=FALSE, results='hide'}
        #tried to hide the load messages from showing up in the generated code
        #but could not so this will show no matter what
        #load the dplyr package in oder to use group_by function
        if (!require(dplyr)) 
        {
                install.packages("dplyr")
                library(dplyr)
                require(dplyr)
        }


        #load the ggplot2 package for plotting
        if (!require(ggplot2)) 
        {
                install.packages("ggplot2")
                library(ggplot2)
                require(ggplot2)
        }
        
        #load the tidyr package for doing some cleaning of data
        if (!require(tidyr)) 
        {
                install.packages("tidyr")
                library(tidyr)
                require(tidyr)
        }

```


## Loading and Preprocessing the Data  
```{r}

        data <- read.csv("activity.csv", header=T)

        #data$date <- as.POSIXct(data$date)

        #add a feature to identify the type of day (weekday vs weekend) to be used in some
        #later analysis
        data$typeofday[weekdays(as.POSIXct(data$date)) %in% c('Saturday','Sunday')] <- "Weekend"

        #any "typeofday" value that is NA is a weekday so set it as such below
        data$typeofday[is.na(data$typeofday)] <- "Weekday"

        #convert typeofday to a factor variable
        data$typeofday <-as.factor(data$typeofday)

```


## Mean and Median Steps Per Day  
```{r}
       
        #use only the non NA values in this calculation
        #group by date and count the total number of steps per day
        date.based.summary <- data[complete.cases(data),]%>%
                group_by(date)%>% 
                        summarise(totalsteps=sum(steps))

        #create a histogram
        hist (date.based.summary$totalsteps, main="Total Steps", xlab="Total Steps", col="blue")


        meansteps <- as.character(round(mean(date.based.summary$totalsteps), digits=0))
        mediansteps <- as.character(round(median(date.based.summary$totalsteps), digits=0))


```

* The average number of steps taken per day were `r meansteps` and the median number of steps were `r mediansteps`


## Daily Activity Patterns  
```{r}
        # Make a time series plot (i.e. type = "l") of the 5-minute interval (x-axis) and the
        #average number of steps taken, averaged across all days (y-axis)

        interval.based.summary <- data[complete.cases(data),]%>%
                group_by(interval)%>% 
                        summarise(meansteps=mean(steps))

        plot(interval.based.summary$interval, interval.based.summary$meansteps, type = "l", 
        main = "Average Steps per Time Period", xlab = "Time Period", ylab = "Average Steps")


        # Which 5-minute interval, on average across all the days in the dataset, contains the                
        #maximum number of steps?

        most.active.time <- as.character(subset(interval.based.summary, meansteps==max(meansteps), 
        select=c("interval")))

```

* The most active time period of the day is period `r most.active.time`  


## Imputing Missing Values  

```{r}

#Calculate and report the total number of missing values in the dataset 
#(i.e. the total number of rows with NAs)

missing.steps <- sum(is.na(data$steps))
missing.date <- sum(is.na(data$date))
missing.interval <- sum(is.na(data$interval))

```

* There are `r missing.steps` observations with missing steps
* There are `r missing.date` observations with missing dates
* There are `r missing.interval` observations with missing intervals


```{r}
#Devise a strategy for filling in all of the missing values in the dataset. 
#The strategy does not need to be sophisticated. For example, you could use 
#the mean/median for that day, or the mean for that 5-minute interval, etc.

#here is the data with NA values that we will want to fill in the blanks for
nadata <- data[!complete.cases(data),]

#this is the data that is fully populated
completedata <- data[complete.cases(data),]

#join the nadata to the interval based dataset so we can fill in the blanks
nadata <- merge (nadata, interval.based.summary, by.x="interval", by.y="interval", all.x=FALSE, all.y=FALSE)

#use mutate to update the steps feature (with NA's) with the meansteps from the interval set
nadata <- mutate(nadata, steps = round(meansteps, digits=0))

#drop the meansteps feature - no longer needed
nadata$meansteps<-NULL

#combine the updated nadata with the completedata to produce the final dataset.
newdata <- rbind(nadata,completedata)

date.based.summary <- newdata%>%
                group_by(date)%>% 
                        summarise(totalsteps=sum(steps))

hist (date.based.summary$totalsteps, main="Total Steps", xlab="Total Steps", col="blue")

meansteps <- as.character(round(mean(date.based.summary$totalsteps), digits=0))
mediansteps <- as.character(round(median(date.based.summary$totalsteps), digits=0))


```


* The average number of steps taken per day **(after imputing missing data)** were `r meansteps` and the median number of steps were `r mediansteps`  




## Weekday vs Weekend Activity Patterns  

```{r}
       #group by interval and type of day for summarization at that level
        by_interval_and_type <- group_by (newdata, 
                                         combo = paste(interval, typeofday, sep= "~"))
        
        #calculate the mean by interval and type
        weekday.vs.weekend.summary <- summarize(by_interval_and_type, mean(steps))
      
        #call the separate function to create a "year" column and "typeofday" column
        weekday.vs.weekend.summary <- separate(data=weekday.vs.weekend.summary, 
                                               col=combo, into=c("interval", "typeofday"), 
                                               sep= "~")

        weekday.vs.weekend.summary$typeofday <- as.factor(weekday.vs.weekend.summary$typeofday)

        colnames(weekday.vs.weekend.summary)[3] <- "meansteps"
        
        weekday.vs.weekend.summary$interval <- as.numeric(weekday.vs.weekend.summary$interval)


        weekdaymean <- round(mean(subset(weekday.vs.weekend.summary, 
                                   typeofday=="Weekday", 
                                   select=c("meansteps"))$meansteps), digits=0)

        weekendmean <- round(mean(subset(weekday.vs.weekend.summary, 
                                   typeofday=="Weekend", 
                                   select=c("meansteps"))$meansteps), digits=0)

        #this next piece is not required per the instructions but i wanted to show
        #some different annotation on the plots by facet to include the average
        #steps by time period for each facet.
        #i had to create a little data frame with the x & y co-ords for each plot.
        #in order to get ggplot to understand which facet to put the text on,
        #i needed to include the typeofday feature which is what is used for the facet
        # thanks to TRinkers R blog for pointing me in the right direction because it had 
        #me stumped.  
        #https://trinkerrstuff.wordpress.com/2012/09/01/add-text-annotations-to-ggplot2-faceted-plot/
        
        annotation.text.info <- data.frame(x=c(180,180), y=c(weekdaymean+8, weekendmean+8), 
                        label=c(paste("Mean Per Period:", weekdaymean),
                                paste("Mean Per Period:",weekendmean)), 
                                typeofday=c("Weekday","Weekend"))

     
   
        p <- ggplot(weekday.vs.weekend.summary, aes(x=interval, y=meansteps))
        p <- p + geom_line(color="firebrick")
        p <- p + labs (title="Weekday vs Weekend Activity Comparison")
        p <- p + labs (x="Time Interval")
        p <- p + labs (y="Average Steps")
        p <- p + facet_wrap(~typeofday, ncol=1)
        p <- p + geom_line(stat = "hline", yintercept = "mean", color='blue', linetype=2)
        p <- p + geom_text(aes(x, y, label=label, group=NULL), data=annotation.text.info, 
                           color = "grey50", size=4) 

        print (p)



```

* The average number of steps taken per 5 minute time period during the week were `r weekdaymean` and the average number of steps taken per 5 minute time period on the weekend were `r weekendmean`
* The weekday pattern exhibits a big spike early in the morning (could be walking to work or gym) and then very moderate activity during the day.
* The weekend pattern also exhibits a bigger spike early in the morning but then a much higher rate of activity on average compared to the weekday activity.  


- Thanks to [TRinkers R blog](https://trinkerrstuff.wordpress.com/2012/09/01/add-text-annotations-to-ggplot2-faceted-plot/) for providing the guidance I needed to figure out how to put different text annotations on different locations when doing faceted plots.
